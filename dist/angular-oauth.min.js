/*! angular-oauth 26-09-2013 */
"use strict";angular.module("angularOauth",[]).provider("Token",function(){var a=function(a){var b=[];return angular.forEach(a,function(a,c){b.push(encodeURIComponent(c)+"="+encodeURIComponent(a))}),b.join("&")},b="token",c={},d={clientId:c,redirectUri:c,authorizationEndpoint:c,localStorageName:"accessToken",verifyFunc:c,scopes:[]};this.extendConfig=function(a){d=angular.extend(d,a)},this.$get=function(e,f,g,h){var i=[];if(angular.forEach(d,function(a,b){a===c&&i.push(b)}),i.length)throw new Error("TokenProvider is insufficiently configured.  Please configure the following options using TokenProvider.extendConfig: "+i.join(", "));if(!d.clientId)throw new Error("clientId needs to be configured using TokenProvider.");var j=function(){return{response_type:b,client_id:d.clientId,redirect_uri:d.redirectUri,scope:d.scopes.join(" ")}};return{get:function(){return localStorage[d.localStorageName]},set:function(a){localStorage[d.localStorageName]=a},verifyAsync:function(a){return d.verifyFunc(d,a)},getTokenByPopup:function(b,c){c=angular.extend({name:"AuthPopup",openParams:{width:650,height:300,resizable:!0,scrollbars:!0,status:!0}},c);var f=e.defer(),i=angular.extend(j(),b),k=d.authorizationEndpoint+"?"+a(i),l=function(a){var b=[];return angular.forEach(a,function(a,c){(a||0===a)&&(a=a===!0?"yes":a,b.push(c+"="+a))}),b.join(",")},m=window.open(k,c.name,l(c.openParams));return angular.element(g).bind("message",function(a){a.source===m&&a.origin===window.location.origin&&h.$apply(function(){a.data.access_token?f.resolve(a.data):f.reject(a.data)})}),f.promise}}}}).controller("CallbackCtrl",function(a,b){function c(a){var b,c,d={};return angular.forEach((a||"").split("&"),function(a){a&&(b=a.split("="),c=decodeURIComponent(b[0]),d[c]=angular.isDefined(b[1])?decodeURIComponent(b[1]):!0)}),d}var d=b.path().substring(1),e=c(d);window.opener.postMessage(e,"*"),window.close()}),angular.module("googleOauth",["angularOauth"]).constant("GoogleTokenVerifier",function(a,b){var c=angular.injector(["ng"]);return c.invoke(["$http","$rootScope","$q",function(c,d,e){var f=e.defer(),g="https://www.googleapis.com/oauth2/v1/tokeninfo";return d.$apply(function(){c({method:"GET",url:g,params:{access_token:b}}).success(function(b){b.audience===a.clientId?f.resolve(b):f.reject({name:"invalid_audience"})}).error(function(a,b,c,d){f.reject({name:"error_response",data:a,status:b,headers:c,config:d})})}),f.promise}])}).config(function(a,b){a.extendConfig({authorizationEndpoint:"https://accounts.google.com/o/oauth2/auth",scopes:["https://www.googleapis.com/auth/userinfo.email"],verifyFunc:b})});